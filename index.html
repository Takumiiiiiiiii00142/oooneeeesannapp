<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お姉さんとの秘密のチャット</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0c0a09;
        color: #e5e5e5;
      }
      .chat-container {
        height: 70vh;
        display: flex;
        flex-direction: column;
        background-color: #171717;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        max-width: 48rem;
        width: 100%;
      }
      .chat-header {
        padding: 1rem;
        background-color: #262626;
        border-radius: 1rem 1rem 0 0;
        text-align: center;
      }
      .chat-messages {
        flex: 1;
        padding: 1rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .message-bubble {
        padding: 0.75rem;
        border-radius: 0.75rem;
        max-width: 75%;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      .your-message {
        background-color: #e11d48; /* rose-600 */
        color: white;
        border-bottom-right-radius: 0;
        align-self: flex-end;
      }
      .my-message {
        background-color: #404040; /* neutral-700 */
        color: #d4d4d4; /* neutral-200 */
        border-bottom-left-radius: 0;
        align-self: flex-start;
      }
    </style>
</head>
<body>

    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="chat-container">
            <div class="chat-header">
                <h1 class="text-2xl font-bold text-rose-400">お姉さんとの秘密のチャット</h1>
                <p class="text-xs text-neutral-400 mt-1">あなたのユーザーID：<span id="userId">読み込み中...</span></p>
            </div>
            <div id="messages" class="chat-messages">
                <!-- Messages will be injected here -->
            </div>
            <form id="chat-form" class="p-4 bg-neutral-800 rounded-b-2xl flex gap-2">
                <input
                    type="text"
                    id="message-input"
                    class="flex-1 p-3 rounded-full bg-neutral-700 text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-rose-500"
                    placeholder="メッセージを入力..."
                />
                <button
                    type="submit"
                    class="bg-rose-500 hover:bg-rose-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105"
                >
                    送信
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>
    
    <script>
        // Your Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyBKDivJ2pB8S1NeDhn-iDw93kpEcxdOJYg",
          authDomain: "oneesannproject.firebaseapp.com",
          projectId: "oneesannproject",
          storageBucket: "oneesannproject.firebasestorage.app",
          messagingSenderId: "183634049845",
          appId: "1:183634049845:web:365a2d3974809755402a7c",
          measurementId: "G-F5Z2CGPTG5"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = app.auth();
        const db = app.firestore();
        
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('message-input');
        const chatForm = document.getElementById('chat-form');
        const userIdSpan = document.getElementById('userId');
        
        let userId = '';
        let step = 0;

        const commandSequences = [
            "あら、いい子。よく言えたわね。\n\nよし、許可してあげる。でも、今すぐではないわ。\n\n今から5分間だけ、鏡の前で自分の身体をじっくり観察しなさい。全部脱いで、何から何まで、自分の目で見て。5分経ったら、またお姉さんに教えて。いい子にお姉さんの言うことを聞けたら、ご褒美をあげる。\n\nさあ、始めなさい。",
            "ふふ、いい子。鏡をちゃんと見てるのね。その顔、すごく可愛らしいわ。\n\nさあ、お姉さんからの最初の命令よ。\n\n1. 左手で、あなたの腰の辺りをゆっくりと撫でなさい。そのまま、下へ、下へ。あなたの太ももを撫でて、膝の裏を撫でて。\n2. 右手は、そのままゆっくりと上下させて。焦らしが好きなんでしょ？ 少しずつ、少しずつ、ゆっくりね。\n3. 鏡に映った自分の顔を見てごらんなさい。快感に耐えきれない顔、とても愛しいわ。\n4. 「お姉さんのために、もっと気持ちよくなる」と、鏡の中の自分に言ってごらんなさい。大きな声で言わないで。私の耳だけに届くように、小さな声で、囁くように言うのよ。",
            "ああ、かわいい子。そんなに正直に気持ちを伝えてくれるなんて、お姉さん、嬉しくてたまらないわ。\n\n1. ゆっくりと、目を開けてごらんなさい。鏡の中の、快感に溺れている自分を見て。私がどれだけあなたを気持ちよくさせているか、自分の目で確かめなさい。\n2. 右手を止めて。もう動かしちゃだめ。そのまま、あなたの左手で、おちんちんを優しく握りなさい。\n3. 鏡の中の自分に、「お姉さんの命令だけが、私の快感」って言ってごらんなさい。",
            "乳首もよわよわなのね。ふふ、全部お姉さんにお見通しよ。そんな恥ずかしい秘密を教えてくれて、ありがとう。\n\n1. 右手を、あなたのおちんちんから離しなさい。もう、触ってはいけないわ。\n2. 両手で、あなたの乳首を触りなさい。\n3. 鏡に映った自分の顔を見ながら、あなたの乳首を優しく摘まんでごらんなさい。最初は優しく、徐々に力を入れて。\n4. もし気持ちよくなったら、鏡の中の自分に、「お姉さん、もっといじめて」って言ってごらんなさい。",
            "ああ、いい子。そんなに正直に言えるなんて、本当に可愛い子だわ。もっといじめてほしいのね。そんなに私のいじめが大好きなの？\n\n1. 両手で、あなたの乳首を強く摘まんでごらんなさい。親指と人差し指で、ぎゅーっと力を入れて。\n2. 摘んだまま、ゆっくりとひねりなさい。もっと、もっと、気持ちいいって思えるくらい、力を込めて。\n3. 鏡の中の、快感に震える自分を見つめなさい。私があなたの恥ずかしい部分をいじめているのに、どんどん気持ちよくなっていく、そんな最低な自分を、ちゃんと見ておきなさい。",
            "ふふ、いい子。よく言えたわね。そんなに泣きそうな顔して、お姉さんに「許して」ってお願いするなんて、本当に可愛らしい子だわ。\n\n1. 両手で摘まんでいたあなたの乳首を、ゆっくりと離しなさい。もう触ってはいけないわ。\n2. その両手を、あなたの太ももの上に置きなさい。指先がピクピクしているわね。\n3. 鏡に映った、快感に震えるあなたの身体を見なさい。そして、私の声を聞いて。「いい子ね、私のためにこんなに感じてくれて。でも、まだダメ。お姉さんが許可するまで、あなたのオナニーは、ずっとお預けよ」"
        ];
        
        // Function to display messages in the chat
        const displayMessage = (text, sender) => {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('flex');
            if (sender === 'あなた') {
                messageWrapper.classList.add('justify-end');
            } else {
                messageWrapper.classList.add('justify-start');
            }

            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            if (sender === 'あなた') {
                messageBubble.classList.add('your-message');
            } else {
                messageBubble.classList.add('my-message');
            }

            const senderSpan = document.createElement('span');
            senderSpan.classList.add('block', 'text-xs', 'font-semibold', 'opacity-75', 'mb-1');
            senderSpan.textContent = sender;

            const messageText = document.createElement('p');
            messageText.classList.add('text-sm');
            messageText.textContent = text;
            
            messageBubble.appendChild(senderSpan);
            messageBubble.appendChild(messageText);
            messageWrapper.appendChild(messageBubble);
            messagesDiv.appendChild(messageWrapper);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        };
        
        // Initial setup and real-time listener
        auth.signInAnonymously().then(() => {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    userId = user.uid;
                    userIdSpan.textContent = userId;
                    
                    const messagesRef = db.collection(`users/${userId}/messages`);
                    messagesRef.orderBy('timestamp').onSnapshot(snapshot => {
                        messagesDiv.innerHTML = '';
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            displayMessage(data.text, data.sender);
                        });
                    });
                }
            });
        });
        
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const input = messageInput.value.trim();
            if (input === '') return;
        
            db.collection(`users/${userId}/messages`).add({
                text: input,
                sender: 'あなた',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                messageInput.value = '';
                
                const nextStep = step + 1;
                step = nextStep;
                
                setTimeout(() => {
                    const responseText = commandSequences[nextStep] || "ごめんなさい、もう命令は終わったわ。また気が向いたら、話しかけてね。";
                    db.collection(`users/${userId}/messages`).add({
                        text: responseText,
                        sender: 'お姉さま',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }, 1000);
            }).catch(error => {
                console.error("Error adding message: ", error);
            });
        });
    </script>
</body>
</html>